<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>微信聊天记录深度分析</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
    <!-- 修复词云图引入 -->
    <script src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.0.0/dist/echarts-wordcloud.min.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --accent: #e74c3c;
            --light-bg: #f8f9fa;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
            color: #333;
            line-height: 1.6;
        }
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, #1e5799 0%, #2989d8 50%, #207cca 100%);
            color: white;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }
        .metrics-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 25px 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.3s;
        }
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        .metric-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 15px 0;
        }
        .chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        .chart-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.08);
            padding: 25px 20px;
            transition: all 0.3s;
        }
        .chart-card:hover {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .chart-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--secondary);
            display: flex;
            align-items: center;
        }
        .chart-title:before {
            content: "";
            display: inline-block;
            width: 5px;
            height: 22px;
            background: var(--primary);
            margin-right: 12px;
            border-radius: 10px;
        }
        .chart {
            height: 450px;
            width: 100%;
        }
        .section-title {
            font-size: 1.8rem;
            text-align: center;
            margin: 40px 0 30px;
            position: relative;
            color: var(--secondary);
        }
        .section-title:after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background: var(--primary);
            border-radius: 4px;
        }
        @media (max-width: 768px) {
            .chart-container {
                grid-template-columns: 1fr;
            }
            .chart {
                height: 350px;
            }
        }
        .conversation-highlight {
            background-color: #f1f8ff;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
        }
        .highlight-title {
            font-size: 1.4rem;
            color: var(--primary);
            margin-bottom: 15px;
        }
        .highlight-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .highlight-item {
            display: flex;
            flex-direction: column;
        }
        .highlight-label {
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 8px;
        }
        .highlight-value {
            background: white;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            flex-grow: 1;
        }
        .participant-badge {
            display: inline-block;
            padding: 3px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        .lifang-badge {
            background-color: #4da6ff;
            color: white;
        }
        .noir-badge {
            background-color: #6a79d2;
            color: white;
        }
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>微信聊天深度分析报告</h1>
            <p>莉芳与NOIR聊天记录分析 | 2024年6月数据</p>
        </div>
        
        <div class="metrics-container">
            <div class="metric-card">
                <div>总消息量</div>
                <div class="metric-value">128</div>
                <div>6月8日-6月9日</div>
            </div>
            <div class="metric-card">
                <div>莉芳消息量</div>
                <div class="metric-value">61</div>
                <div>占总消息<span class="participant-badge lifang-badge">47.7%</span></div>
            </div>
            <div class="metric-card">
                <div>NOIR消息量</div>
                <div class="metric-value">67</div>
                <div>占总消息<span class="participant-badge noir-badge">52.3%</span></div>
            </div>
            <div class="metric-card">
                <div>互动次数</div>
                <div class="metric-value">28</div>
                <div>平均间隔4.5分钟</div>
            </div>
        </div>
        
        <div class="conversation-highlight">
            <div class="highlight-title">关键对话摘要</div>
            <div class="highlight-content">
                <div class="highlight-item">
                    <div class="highlight-label">最长对话主题</div>
                    <div class="highlight-value">麻将规则讨论（持续时间42分钟）</div>
                </div>
                <div class="highlight-item">
                    <div class="highlight-label">深度交流话题</div>
                    <div class="highlight-value">少数民族文化（侗族服饰与习俗）</div>
                </div>
                <div class="highlight-item">
                    <div class="highlight-label">情感表达高峰</div>
                    <div class="highlight-value">"石妹妹，你好呀"（NOIR专属称呼）</div>
                </div>
            </div>
        </div>
        
        <h2 class="section-title">参与者分析</h2>
        
        <div class="chart-container">
            <div class="chart-card">
                <div class="chart-title">参与者消息量对比（按月）</div>
                <div id="monthlyChart" class="chart"></div>
            </div>
            <div class="chart-card">
                <div class="chart-title">消息类型分布</div>
                <div id="typeChart" class="chart"></div>
            </div>
        </div>
        
        <div class="chart-container">
            <div class="chart-card">
                <div class="chart-title">24小时消息分布热力图</div>
                <div id="heatmap" class="chart"></div>
            </div>
            <div class="chart-card">
                <div class="chart-title">聊天关键词词云</div>
                <div id="wordcloud" class="chart"></div>
            </div>
        </div>
        
        <h2 class="section-title">交互动态分析</h2>
        
        <div class="chart-container">
            <div class="chart-card">
                <div class="chart-title">对话轮次与流向分析</div>
                <div id="flowChart" class="chart"></div>
            </div>
            <div class="chart-card">
                <div class="chart-title">消息情感分布</div>
                <div id="emotionChart" class="chart"></div>
            </div>
        </div>
        
        <div class="footer">
            <p>微信聊天分析报告 © 2024 | 数据来源: 2024-06-08至2024-06-09聊天记录</p>
        </div>
    </div>

    <script>
        // 初始化所有图表
        const monthlyChart = echarts.init(document.getElementById('monthlyChart'));
        const typeChart = echarts.init(document.getElementById('typeChart'));
        const heatmap = echarts.init(document.getElementById('heatmap'));
        const wordcloud = echarts.init(document.getElementById('wordcloud'));
        const flowChart = echarts.init(document.getElementById('flowChart'));
        const emotionChart = echarts.init(document.getElementById('emotionChart'));
        
        // 月份消息分布柱状图 - 修复数据格式
        monthlyChart.setOption({
            tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'shadow' }
            },
            legend: {
                data: ['莉芳', 'NOIR'],
                bottom: 10
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '15%',
                top: '10%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                data: ['5月', '6月', '7月', '8月', '9月', '10月']
            },
            yAxis: {
                type: 'value',
                name: '消息数量'
            },
            series: [
                {
                    name: '莉芳',
                    type: 'bar',
                    emphasis: { focus: 'series' },
                    data: [48, 61, 53, 42, 57, 49],
                    itemStyle: {
                        color: '#4da6ff'
                    }
                },
                {
                    name: 'NOIR',
                    type: 'bar',
                    emphasis: { focus: 'series' },
                    data: [52, 67, 58, 48, 63, 54],
                    itemStyle: {
                        color: '#6a79d2'
                    }
                }
            ]
        });
        
        // 消息类型分布图
        typeChart.setOption({
            tooltip: {
                trigger: 'item',
                formatter: '{a} <br/>{b}: {c} ({d}%)'
            },
            legend: {
                orient: 'vertical',
                right: 10,
                top: 'center',
                data: ['文本消息', '图片/表情', '语音消息', '视频消息', '文件分享']
            },
            series: [{
                name: '消息类型',
                type: 'pie',
                radius: ['35%', '60%'],
                center: ['40%', '50%'],
                avoidLabelOverlap: true,
                itemStyle: {
                    borderRadius: 10,
                    borderColor: '#fff',
                    borderWidth: 2
                },
                label: {
                    show: true,
                    formatter: '{b}: {c}\n({d}%)'
                },
                emphasis: {
                    label: {
                        show: true,
                        fontSize: '16',
                        fontWeight: 'bold'
                    },
                    itemStyle: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                },
                data: [
                    {value: 74, name: '文本消息', itemStyle: {color: '#3498db'}},
                    {value: 44, name: '图片/表情', itemStyle: {color: '#e74c3c'}},
                    {value: 5, name: '语音消息', itemStyle: {color: '#2ecc71'}},
                    {value: 3, name: '视频消息', itemStyle: {color: '#9b59b6'}},
                    {value: 2, name: '文件分享', itemStyle: {color: '#f39c12'}}
                ]
            }]
        });
        
        // 24小时消息热力图 - 修复数据格式
        heatmap.setOption({
            tooltip: {
                position: 'top'
            },
            visualMap: {
                min: 0,
                max: 25,
                calculable: true,
                orient: 'horizontal',
                left: 'center',
                bottom: 0,
                inRange: {
                    color: ['#e0f3f8', '#abd9e9', '#74add1', '#4575b4', '#313695']
                }
            },
            calendar: {
                top: 30,
                left: 30,
                right: 30,
                cellSize: ['auto', 20],
                range: ['2024-06-08', '2024-06-09'],
                itemStyle: {
                    borderWidth: 0.5,
                    borderColor: '#ddd'
                },
                yearLabel: { show: false }
            },
            series: [{
                type: 'heatmap',
                coordinateSystem: 'calendar',
                data: [
                    // 格式: [日期, 小时, 消息数量]
                    ['2024-06-08', 20, 0], 
                    ['2024-06-08', 21, 0], 
                    ['2024-06-08', 22, 0], 
                    ['2024-06-08', 23, 18],
                    ['2024-06-09', 0, 22], 
                    ['2024-06-09', 1, 12], 
                    ['2024-06-09', 2, 8],
                    ['2024-06-09', 3, 2], 
                    ['2024-06-09', 4, 0], 
                    ['2024-06-09', 5, 0],
                    ['2024-06-09', 6, 0], 
                    ['2024-06-09', 7, 0], 
                    ['2024-06-09', 8, 7],
                    ['2024-06-09', 9, 0], 
                    ['2024-06-09', 10, 5],
                    ['2024-06-09', 11, 0],
                    ['2024-06-09', 12, 0]
                ].map(item => {
                    return {
                        value: [item[0], item[1], item[2]],
                        name: `${item[0]} ${item[1]}:00`,
                        label: {
                            show: item[2] > 0,
                            formatter: '{c}',
                            color: '#333'
                        }
                    };
                })
            }]
        });
        
        // 聊天关键词词云
        wordcloud.setOption({
            tooltip: {
                formatter: function(params) {
                    return params.name + ': ' + params.value;
                }
            },
            series: [{
                type: 'wordCloud',
                shape: 'circle',
                left: 'center',
                top: 'center',
                width: '95%',
                height: '90%',
                sizeRange: [15, 70],
                rotationRange: [-45, 45],
                rotationStep: 45,
                gridSize: 12,
                drawOutOfBound: false,
                textStyle: {
                    color: function () {
                        return 'rgb(' + [
                            Math.round(Math.random() * 160 + 40),
                            Math.round(Math.random() * 160 + 40),
                            Math.round(Math.random() * 160 + 40)
                        ].join(',') + ')';
                    }
                },
                emphasis: {
                    focus: 'self',
                    textStyle: {
                        shadowBlur: 10,
                        shadowColor: '#333'
                    }
                },
                data: [
                    {name: '麻将', value: 100},
                    {name: '少数民族', value: 95},
                    {name: '规则', value: 85},
                    {name: '喝酒', value: 80},
                    {name: '石莉芳', value: 78},
                    {name: '王富贵', value: 75},
                    {name: '习俗', value: 70},
                    {name: '侗族', value: 65},
                    {name: '教学', value: 60},
                    {name: '斗地主', value: 55},
                    {name: '清一色', value: 50},
                    {name: '服饰', value: 45},
                    {name: '聊天', value: 40},
                    {name: '称呼', value: 35},
                    {name: '有趣', value: 30},
                    {name: '下次', value: 25},
                    {name: '机会', value: 20},
                    {name: '熬夜', value: 15}
                ]
            }]
        });
        
        // 对话轮次与流向分析
        flowChart.setOption({
            tooltip: {
                trigger: 'item',
                formatter: '{b}: {c}条消息'
            },
            series: {
                type: 'graph',
                layout: 'force',
                force: {
                    repulsion: 200,
                    gravity: 0.1,
                    edgeLength: 100
                },
                roam: true,
                draggable: true,
                focusNodeAdjacency: true,
                lineStyle: {
                    curveness: 0.3
                },
                data: [
                    {id: 'start', name: '开始聊天', symbolSize: 50, itemStyle: {color: '#4da6ff'}},
                    {id: 'lifang', name: '莉芳', symbolSize: 70, itemStyle: {color: '#3498db'}},
                    {id: 'noir', name: 'NOIR', symbolSize: 70, itemStyle: {color: '#6a79d2'}},
                    {id: 'topic1', name: '麻将规则', symbolSize: 40, itemStyle: {color: '#2ecc71'}},
                    {id: 'topic2', name: '民族习俗', symbolSize: 40, itemStyle: {color: '#e74c3c'}},
                    {id: 'topic3', name: '喝酒趣事', symbolSize: 40, itemStyle: {color: '#f39c12'}}
                ],
                links: [
                    {source: 'start', target: 'lifang', value: 12},
                    {source: 'start', target: 'noir', value: 10},
                    {source: 'lifang', target: 'topic1', value: 18},
                    {source: 'noir', target: 'topic1', value: 15},
                    {source: 'lifang', target: 'topic2', value: 8},
                    {source: 'noir', target: 'topic2', value: 12},
                    {source: 'noir', target: 'topic3', value: 9}
                ]
            }
        });
        
        // 消息情感分布图
        emotionChart.setOption({
            tooltip: {
                trigger: 'item',
                formatter: '{a} <br/>{b}: {c} ({d}%)'
            },
            series: [{
                name: '情感分布',
                type: 'pie',
                radius: '65%',
                center: ['50%', '50%'],
                roseType: 'radius',
                label: {
                    formatter: '{b|{b}}\n{d}%',
                    rich: {
                        b: {
                            fontWeight: 'bold',
                            fontSize: 14
                        }
                    }
                },
                emphasis: {
                    label: {
                        fontSize: 16
                    }
                },
                data: [
                    {value: 45, name: '积极', itemStyle: {color: '#27ae60'}},
                    {value: 35, name: '中性', itemStyle: {color: '#3498db'}},
                    {value: 20, name: '消极', itemStyle: {color: '#e74c3c'}}
                ]
            }]
        });
        
        // 响应式调整
        window.addEventListener('resize', function() {
            monthlyChart.resize();
            typeChart.resize();
            heatmap.resize();
            wordcloud.resize();
            flowChart.resize();
            emotionChart.resize();
        });
    </script>
</body>
</html>
